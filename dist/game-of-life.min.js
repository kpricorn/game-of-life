/*! game-of-life 16-09-2013 */
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["lodash"],function(b){var c;return c=function(){function c(b){this.field=null!=b?b:{},this.turn=a(this.turn,this),this.isAlive=a(this.isAlive,this),this.livingNeighbours=a(this.livingNeighbours,this),this.play=a(this.play,this),this.neighboursCoords=a(this.neighboursCoords,this),this.candidates=a(this.candidates,this)}var d,e;return c.prototype.NEIGHBOUR_MATRIX=b.flatten(function(){var a,b;for(b=[],d=a=-1;1>=a;d=++a)b.push(function(){var a,b;for(b=[],e=a=-1;1>=a;e=++a)b.push([d,e]);return b}());return b}(),!0),c.prototype.get=function(a,b){return this.field[""+a+"/"+b]},c.prototype.set=function(a,b){return this.field[this.toInternal(a,b)[0]]=this.toInternal(a,b)[1]},c.prototype.toInternal=function(a,b){return[""+a+"/"+b,[a,b]]},c.prototype.cells=function(){var a=this;return Object.keys(this.field).map(function(b){return a.field[b]})},c.prototype.candidates=function(){var a,c;return b.flatten(function(){var b,d,e,f,g;for(e=this.cells(),g=[],b=0,d=e.length;d>b;b++)f=e[b],a=f[0],c=f[1],g.push(this.neighboursCoords(a,c));return g}.call(this),!0)},c.prototype.neighboursCoords=function(a,b){var c,d,e,f,g,h,i;for(g=this.NEIGHBOUR_MATRIX,i=[],e=0,f=g.length;f>e;e++)h=g[e],c=h[0],d=h[1],i.push([a+c,b+d]);return i},c.prototype.allDead=function(){return 0===Object.keys(this.field).length},c.prototype.play=function(){var a;for(a=[];!this.allDead();)a.push(this.turn());return a},c.prototype.livingNeighbours=function(a,c){var d=this;return b.select(this.neighboursCoords(a,c),function(a){var b,c;return b=a[0],c=a[1],null!=d.get(b,c)})},c.prototype.isAlive=function(a,b){var c;return null!=this.get(a,b)?1<(c=this.livingNeighbours(a,b).length-1)&&4>c:3===this.livingNeighbours(a,b).length},c.prototype.turn=function(){var a=this;return this.field=b.object(b.select(this.candidates(),function(b){var c,d;return c=b[0],d=b[1],a.isAlive(c,d)}).map(function(b){var c,d;return c=b[0],d=b[1],a.toInternal(c,d)}))},c}(),{Game:c}})}).call(this);